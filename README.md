# chess-engine

<h2>BugHouse do šachových enginov</h2>

<h4>Patrik Černý, školiteľ: Mrg. Šimon Sádovský.</h4>

<h5>Cieľ zimného semestra: </h5> Implementovať bughouse do existujúceho šachového enginu a začať so zlepšovaním jeho časovej zložitosti pomocou techník používaných pri klasických enginoch, napr AplhaBeta cutoffs, MoveOrdering atď.. 


<h5>Report mojej práce z prvého semestra:</h5>

Prácu som začal dôkladnou analýzou chess enginov TSCP a Sunsetter a analýzou ich kódu som postupne zistoval aké algoritmy a štruktúry používajú na implementáciu enginu. Následne som sa neúspešne pokúsil do spomenutých enginov doprogramovať bughouse mód pre šach, avšak kvôli nedostatku skúseností s c++/c sa mi to ani po dlhej práci nepodarilo. Preto som sa rozhodol pre vlastnú implementáciu aj šachu ako takého aj enginu, ktorý budem používať. Použil som Javu, v ktorej som pracoval počas štúdia najviac. Ako základný engine algoritmus som si vybral minimax, ktorý mám v pláne nahradiť Alpha-beta algoritmom v ďaľšom semestri. Ako programovaciu techniku som využil Immutables, ktoré sa principiálne hodia na programovanie šachu a enginu. Bughouse engine je funkčný, okrem zopár bugov ktoré treba vyriešiť, vo svojom súkromnom commite mám uložený aj engine pre šach klasický ako aj funkčné GUI pre klasický šach, ktoré v ďalšom semestri rozšírim aj pre bughouse. Ako som spomínal, samotná hra využíva MiniMax, ktorý je upravený pre potreby bughouse šachu, pravidlá šachu sú samozrejme upravené tiež. Minimax využíva pomocnú funkciu Evaluate, ktorá ohodnotí pozíciu v ktorej sa aktuálne nachádzame podľa viacerých pravidiel, a vracia enginu najlepší nájdený ťah v jeho zadanej hĺbke. Engine zatiaľ zvláda hĺbku 1 až 5 v rozumnom čase(do 1 min). Samozrejme hĺbka priamo ovplyvňuje kvalitu šachovej hry enginu, ale je vidieť že engine vyberá lepšie ťahy a neprehráva hru rozdávaním figúr. 

<h5> Kam bude projekt pokračovať ? </h5>
Ako som spomínal v reporte, Minimax bude nahradený Alpha-betou, pridanie dependency enginu na čase(aktuálne engine prehľadáva strom pozícií až kým neprejde všetky pozície v uživateľom zadanej hĺbke), v pláne je pridanie techník na zlepšenie časovej zložitosti a dorobenie GUI pre šachový mód bughouse ako aj klasický šach. 

<h5>Report mojej práce zo zimného semestra:</h5>
Od GUI som upustil, pretože sa netýkalo priamo projektu, a bol to skôr môj osobný cieľ, ktorý sa však nedal splniť z dôvodu rozsahu projektu. 
Základný minimax algoritmus na hľadanie a evaluáciu ťahov som zlepšil použitím techník ako Alphabeta cutoffs, timer pre obe strany, Iterative Deepening a Quinescence search. Tieto metódy som najskôr podrobne študoval v iných šachových enginoch, a následne priamo doprogramoval do Minimaxu. Alphabeta cutoffs mali za následok nárast prehľadávaných nodes od 10-20%, v závislosti od hĺbky. Iterative deepening má jednoduchú funkciu, v pôvodnom Minimaxe z minulého semestra som nevyužíval časové hodiny, algoritmus jednoducho hľadal všetky pozície v užívateľom zadanej hĺbke až kým neprehľadal celý strom. Toto však nie je pri klasickom bughouse vhodné, pretože závisí na čase. Preto aktuálne algoritmus prehľadáva najskôr hĺbky 1, 2, 3, ..., až pokiaľ mu nevyprší čas na daný ťah(tento čas je pre každý ťah počítaný zvlášť, na základe viacerých faktorov). Teda v hocijakom čase má k dispozícii aktuálne najlepší ťah pre danú hĺbku, a zvyšuje hĺbku až kým mu nevyprší čas. Na konci tohoto searchu vráti ťah a spustí sa Quinescence search, teda vo vybranej vetve ťahov, ktorú našiel MiniMax, sa na výsledný ťah spustí krátky, plytký search, ktorý hľadá lokálne chyby a veľké omyly, napr. ak sme našli v hĺbke 7 ťah ..Nxc3, vrátime ho, a na tento ťah sa do hĺbky 2 spustí quinescence search. V skratke, tento dodatočný search sa uisťuje, že v konkrétne vybranom ťahu nie sú plytké chyby na konci ďaľším prehladávaním. 

Engine je teraz schopný hrať bughouse na vcelku slušnej úrovni(1500 ELO), používa vyhodené figúrky na druhej šachovnici a jeho evaluate funkcia, ktorá vracia statickú evaluáciu pozície je kvalitnejšia ako minulý semester. Stále však má plno chýb, napr. koncovky, v niektorých situáciách neregistruje mat na pár ťahov, či ťahy tými istými figúrkami. Celkové zlepšenie, ako som spomínal, oproti minulému semestru, je vo veľa situáciách až 20% viac staticky evaluovaných pozícií, o kvalite evaluate funkcie nehovoriac. 
